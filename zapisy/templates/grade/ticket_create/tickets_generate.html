{% extends "grade/base.html" %}
{% load render_bundle from webpack_loader %}

{% block js %}{{ block.super }}
    {% render_bundle "grade-ticketsgenerate" %}
{% endblock %}

{% block tickets-generate %} class="active"{% endblock %}

{% block main-subtitle %}Pobieranie kluczy{% endblock %}

{% block bread %}
<li class="breadcrumb-item"><a href="/">Strona główna</a></li>
<li class="breadcrumb-item"><a href="{% url 'grade-main' %}">Ocena zajęć</a></li>
<li class="breadcrumb-item active" aria-current="page">Zasady</li>
{% endblock %}

{% block content %}
    <div id="pregen">
        {% if success %}
        <div class="main-success">{{ success }}</div>
        {% endif %}
        {% if message %} 
        <div class="main-message">{{ message }}</div>
        {% endif %}
        {% if error %} 
        <div class="main-error">{{ error }}</div>
        {% endif %}
        {% if grade %}
        <div id="progressbar" style="margin-bottom: 10px;"></div>
    	<div id="grade-tickets-generate">
    	<form method="post" id="tickets_generate">{% csrf_token %}
    	<h2>
    		Pobieranie kluczy do następujących ankiet:
    	</h2>

        <h4>Ankiety przypisane do przedmiotu:</h4>
    	<table id = "grade-tickets-generate-form">
            {% for k, poll in polls.items %}
                <ul>
                    <li><h4><a href="{% url 'course-page' poll.courses.slug %}">{{ poll.courses }}</a></h4>
                        <ul>
                        {% for g in poll.polls %}
                            <li>{{ g }}</li>
                        {% endfor %}
                        </ul>
                    </li>
                </ul>
            {% empty %}
                <h6>Brak ankiet</h6>
            {% endfor %}
        <h4>Ankiety ogólne:</h4>
            {% if general_polls %}
                <ul>
                    {% for p in general_polls %}
                        <li>{{ p }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <h6>Brak ankiet</h6>
            {% endif %}
    	</table>
            {% if general_polls or polls %}
            <div style="text-align: center"><input id="tickets_generate_button" class="btn" type="submit" value="Pobierz klucze"></div>
                {% endif %}
        	</form>
    	</div>

        <div>{{ p }}</div>
        {% endif %}
    </div>
    <div id="postgen" style="display: none;">
        <div id="grade-tickets-save-form">
            <h3> Pomyślnie wygenerowano klucze.</h3>
            <h3>Zapisz je w bezpiecznym miejscu - <strong>nie ma powrotu do tego ekranu</strong>.</h3>
            <br/>
            <div style="text-align: center"><button id="copy-keys" class="btn btn-default">Skopiuj</button></div>
            <br/>
            <pre id="keys" name="keys"></pre>
        </div>
    </div>
{% endblock %}

